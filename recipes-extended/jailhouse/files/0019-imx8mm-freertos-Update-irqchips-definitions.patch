From 76216334c0ec40561d247c9d601dd7c2bc1b82dd Mon Sep 17 00:00:00 2001
From: Stephane Viau <stephane.viau@nxp.com>
Date: Fri, 21 Jan 2022 16:44:33 +0000
Subject: [PATCH 19/48] imx8mm: freertos: Update irqchips definitions

Signed-off-by: Stephane Viau <stephane.viau@nxp.com>
---
 configs/arm64/imx8mm-freertos-audio.c | 26 +++++++++++++-------------
 configs/arm64/imx8mm-freertos.c       | 22 +++++++++++-----------
 configs/arm64/imx8mm-rtos.h           | 20 +++++++++++++++-----
 3 files changed, 39 insertions(+), 29 deletions(-)

diff --git a/configs/arm64/imx8mm-freertos-audio.c b/configs/arm64/imx8mm-freertos-audio.c
index 06eba5d0..d06bda37 100644
--- a/configs/arm64/imx8mm-freertos-audio.c
+++ b/configs/arm64/imx8mm-freertos-audio.c
@@ -1,7 +1,7 @@
 /*
  * i.MX8MM target - FreeRTOS
  *
- * Copyright 2021 NXP
+ * Copyright 2021-2022 NXP
  *
  * Authors:
  *  Stephane Viau <stephane.viau@nxp.com>
@@ -33,18 +33,18 @@
 
 /* GIC */
 #define CONFIG_INMATE_IRQCHIPS_ADDR	(0x38800000)
-#define CONFIG_INMATE_IRQCHIPS_BASE	(32)
-#define CONFIG_INMATE_IRQCHIPS_BITMAP	\
-	/* interrupts 32..63 */        \
-	RTOS_COMMON_IRQCHIPS_BITMAP1,  \
-	/* interrupts 64..95 */        \
-	RTOS_COMMON_IRQCHIPS_BITMAP2 | \
-	(1 << (37 + 32 - 64)),  /* I2C3 */ \
-	/* interrupts 96..127 */       \
-	RTOS_COMMON_IRQCHIPS_BITMAP3 | \
-	(1 << (90 + 32 - 96)), /* SAI5 */ \
-	/* interrupts 128..159 */      \
-	RTOS_COMMON_IRQCHIPS_BITMAP4
+#define CONFIG_INMATE_IRQCHIPS \
+	IRQCHIP0(CONFIG_INMATE_IRQCHIPS_ADDR,              \
+		/* interrupts 32..63 */                    \
+		RTOS_COMMON_IRQCHIP0_BITMAP1,              \
+		/* interrupts 64..95 */                    \
+		RTOS_COMMON_IRQCHIPS_BITMAP2 |             \
+		IRQnMAP(I2C3_IRQn),  /* I2C3 */            \
+		/* interrupts 96..127 */                   \
+		RTOS_COMMON_IRQCHIPS_BITMAP3 |             \
+		IRQnMAP(I2S56_IRQn), /* SAI5 */            \
+		/* interrupts 128..159 */                  \
+		RTOS_COMMON_IRQCHIPS_BITMAP4)
 
 /* IVSHMEM PCI */
 #define CONFIG_INMATE_PCI_DEVICES \
diff --git a/configs/arm64/imx8mm-freertos.c b/configs/arm64/imx8mm-freertos.c
index b60ae3a2..262754c7 100644
--- a/configs/arm64/imx8mm-freertos.c
+++ b/configs/arm64/imx8mm-freertos.c
@@ -1,7 +1,7 @@
 /*
  * i.MX8MM target - FreeRTOS
  *
- * Copyright 2021 NXP
+ * Copyright 2021-2022 NXP
  *
  * Authors:
  *  Stephane Viau <stephane.viau@nxp.com>
@@ -29,16 +29,16 @@
 
 /* GIC */
 #define CONFIG_INMATE_IRQCHIPS_ADDR	(0x38800000)
-#define CONFIG_INMATE_IRQCHIPS_BASE	(32)
-#define CONFIG_INMATE_IRQCHIPS_BITMAP	\
-	/* interrupts 32..63 */         \
-	RTOS_COMMON_IRQCHIPS_BITMAP1,   \
-	/* interrupts 64..95 */         \
-	RTOS_COMMON_IRQCHIPS_BITMAP2,   \
-	/* interrupts 96..127 */        \
-	RTOS_COMMON_IRQCHIPS_BITMAP3,   \
-	/* interrupts 128..159 */       \
-	RTOS_COMMON_IRQCHIPS_BITMAP4
+#define CONFIG_INMATE_IRQCHIPS \
+	IRQCHIP0(CONFIG_INMATE_IRQCHIPS_ADDR,              \
+		/* interrupts 32..63 */                    \
+		RTOS_COMMON_IRQCHIP0_BITMAP1,              \
+		/* interrupts 64..95 */                    \
+		RTOS_COMMON_IRQCHIPS_BITMAP2,              \
+		/* interrupts 96..127 */                   \
+		RTOS_COMMON_IRQCHIPS_BITMAP3,              \
+		/* interrupts 128..159 */                  \
+		RTOS_COMMON_IRQCHIPS_BITMAP4)
 
 /* IVSHMEM PCI */
 #define CONFIG_INMATE_PCI_DEVICES \
diff --git a/configs/arm64/imx8mm-rtos.h b/configs/arm64/imx8mm-rtos.h
index c78a52ef..6ebdfc17 100644
--- a/configs/arm64/imx8mm-rtos.h
+++ b/configs/arm64/imx8mm-rtos.h
@@ -1,7 +1,7 @@
 /*
  * i.MX8MM target - common RTOS config
  *
- * Copyright 2021 NXP
+ * Copyright 2021-2022 NXP
  *
  * Authors:
  *  Stephane Viau <stephane.viau@nxp.com>
@@ -12,6 +12,16 @@
  *
  */
 
+typedef enum IRQn {
+
+  /* Device specific interrupts */
+  UART4_IRQn                   = 61,               /**< UART-4 ORed interrupt */
+  I2C3_IRQn                    = 69,               /**< I2C-3 Interrupt */
+  GPT2_IRQn                    = 86,               /**< OR of GPT Rollover interrupt line, Input Capture 1 and 2 lines, Output Compare 1, 2, and 3 Interrupt lines */
+  GPT1_IRQn                    = 87,               /**< OR of GPT Rollover interrupt line, Input Capture 1 and 2 lines, Output Compare 1, 2, and 3 Interrupt lines */
+  I2S56_IRQn                   = 122,              /**< SAI5/6 Receive / Transmit Interrupt */
+} IRQn_Type;
+
 #define RTOS_COMMON_MEMORY_REGIONS \
 	MMIO_REGION_RW( 0x302d0000, 0x302d0000, KB(64)), /* GPT1 */                 \
 	MMIO_REGION_RW( 0x302e0000, 0x302e0000, KB(64)), /* GPT2 */                 \
@@ -25,13 +35,13 @@
 	MEM_REGION_ROS( 0xbbafe000, 0xbbafe000, KB(8))   /* IVSHMEM */
 
 /* interrupts 32..63 */
-#define RTOS_COMMON_IRQCHIPS_BITMAP1 \
-	(1 << (29 + 32 - 32)) /* UART4 */
+#define RTOS_COMMON_IRQCHIP0_BITMAP1 \
+	IRQnMAP(UART4_IRQn)
 
 /* interrupts 64..95 */
 #define RTOS_COMMON_IRQCHIPS_BITMAP2 \
-	(1 << (54 + 32 - 64)) | /* GPT2 */ \
-	(1 << (55 + 32 - 64))   /* GPT1 */
+	IRQnMAP(GPT2_IRQn) | \
+	IRQnMAP(GPT1_IRQn)
 
 /* interrupts 96..127 */
 #define RTOS_COMMON_IRQCHIPS_BITMAP3 \
-- 
2.34.1

