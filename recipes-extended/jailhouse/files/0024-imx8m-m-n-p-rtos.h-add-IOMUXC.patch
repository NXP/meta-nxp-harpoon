From 88200d916948b2cec48f7b792ffa9c4b456e86dc Mon Sep 17 00:00:00 2001
From: Fabrice Goucem <fabrice.goucem@nxp.com>
Date: Fri, 28 Jan 2022 12:39:32 +0100
Subject: [PATCH 24/48] imx8m{m,n,p}-rtos.h: add IOMUXC

Signed-off-by: Fabrice Goucem <fabrice.goucem@nxp.com>
---
 configs/arm64/imx8mm-rtos.h | 16 +++++++++-------
 configs/arm64/imx8mn-rtos.h | 16 +++++++++-------
 configs/arm64/imx8mp-rtos.h | 17 ++++++++++-------
 3 files changed, 28 insertions(+), 21 deletions(-)

diff --git a/configs/arm64/imx8mm-rtos.h b/configs/arm64/imx8mm-rtos.h
index 6ebdfc17..5bb54cf0 100644
--- a/configs/arm64/imx8mm-rtos.h
+++ b/configs/arm64/imx8mm-rtos.h
@@ -23,16 +23,18 @@ typedef enum IRQn {
 } IRQn_Type;
 
 #define RTOS_COMMON_MEMORY_REGIONS \
-	MMIO_REGION_RW( 0x302d0000, 0x302d0000, KB(64)), /* GPT1 */                 \
-	MMIO_REGION_RW( 0x302e0000, 0x302e0000, KB(64)), /* GPT2 */                 \
-	MMIO_REGION_ROS(0x30360000, 0x30360000, KB(64)), /* ANA_PLL */              \
-	MMIO_REGION_ROS(0x30380000, 0x30380000, KB(64)), /* CCM */                  \
-	MMIO_REGION_RW( 0x30a60000, 0x30a60000, KB(64)), /* UART4 */                \
 	MEM_REGION_ROS( 0xbbaf0000, 0xbbaf0000, KB(4)),  /* IVSHMEM */              \
 	MEM_REGION_RWS( 0xbbaf1000, 0xbbaf1000, KB(36)), /* IVSHMEM */              \
 	MEM_REGION_ROS( 0xbbafa000, 0xbbafa000, KB(8)),  /* IVSHMEM */              \
 	MEM_REGION_RWS( 0xbbafc000, 0xbbafc000, KB(8)),  /* IVSHMEM */              \
-	MEM_REGION_ROS( 0xbbafe000, 0xbbafe000, KB(8))   /* IVSHMEM */
+	MEM_REGION_ROS( 0xbbafe000, 0xbbafe000, KB(8)),  /* IVSHMEM */              \
+	/* IVSHMEM regions should always be kept on top so PCI_IVS doesn't change */\
+	MMIO_REGION_RW( 0x302d0000, 0x302d0000, KB(64)), /* GPT1 */                 \
+	MMIO_REGION_RW( 0x302e0000, 0x302e0000, KB(64)), /* GPT2 */                 \
+	MMIO_REGION_RWS(0x30330000, 0x30330000, KB(64)), /* IOMUXC */               \
+	MMIO_REGION_ROS(0x30360000, 0x30360000, KB(64)), /* ANA_PLL */              \
+	MMIO_REGION_ROS(0x30380000, 0x30380000, KB(64)), /* CCM */                  \
+	MMIO_REGION_RW( 0x30a60000, 0x30a60000, KB(64))  /* UART4 */                \
 
 /* interrupts 32..63 */
 #define RTOS_COMMON_IRQCHIP0_BITMAP1 \
@@ -52,4 +54,4 @@ typedef enum IRQn {
 	0
 
 #define	RTOS_COMMON_PCI_IVSHMEM \
-	PCI_IVSHMEM_UNDEFINED(1, 0, 5, 1, 3)
+	PCI_IVSHMEM_UNDEFINED(1, 0, 0, 1, 3)
diff --git a/configs/arm64/imx8mn-rtos.h b/configs/arm64/imx8mn-rtos.h
index 8830716a..05300e95 100644
--- a/configs/arm64/imx8mn-rtos.h
+++ b/configs/arm64/imx8mn-rtos.h
@@ -24,16 +24,18 @@ typedef enum IRQn {
 } IRQn_Type;
 
 #define RTOS_COMMON_MEMORY_REGIONS \
-	MMIO_REGION_RW( 0x302d0000, 0x302d0000, KB(64)), /* GPT1 */                 \
-	MMIO_REGION_RW( 0x302e0000, 0x302e0000, KB(64)), /* GPT2 */                 \
-	MMIO_REGION_ROS(0x30360000, 0x30360000, KB(64)), /* ANA_PLL */              \
-	MMIO_REGION_ROS(0x30380000, 0x30380000, KB(64)), /* CCM */                  \
-	MMIO_REGION_RW( 0x30a60000, 0x30a60000, KB(64)), /* UART4 */                \
 	MEM_REGION_ROS( 0xbbaf0000, 0xbbaf0000, KB(4)),  /* IVSHMEM */              \
 	MEM_REGION_RWS( 0xbbaf1000, 0xbbaf1000, KB(36)), /* IVSHMEM */              \
 	MEM_REGION_ROS( 0xbbafa000, 0xbbafa000, KB(8)),  /* IVSHMEM */              \
 	MEM_REGION_RWS( 0xbbafc000, 0xbbafc000, KB(8)),  /* IVSHMEM */              \
-	MEM_REGION_ROS( 0xbbafe000, 0xbbafe000, KB(8))   /* IVSHMEM */
+	MEM_REGION_ROS( 0xbbafe000, 0xbbafe000, KB(8)),  /* IVSHMEM */              \
+	/* IVSHMEM regions should always be kept on top so PCI_IVS doesn't change */\
+	MMIO_REGION_RW( 0x302d0000, 0x302d0000, KB(64)), /* GPT1 */                 \
+	MMIO_REGION_RW( 0x302e0000, 0x302e0000, KB(64)), /* GPT2 */                 \
+	MMIO_REGION_RWS(0x30330000, 0x30330000, KB(64)), /* IOMUXC */               \
+	MMIO_REGION_ROS(0x30360000, 0x30360000, KB(64)), /* ANA_PLL */              \
+	MMIO_REGION_ROS(0x30380000, 0x30380000, KB(64)), /* CCM */                  \
+	MMIO_REGION_RW( 0x30a60000, 0x30a60000, KB(64))  /* UART4 */                \
 
 /* interrupts 32..63 */
 #define RTOS_COMMON_IRQCHIP0_BITMAP1 \
@@ -53,4 +55,4 @@ typedef enum IRQn {
 	0
 
 #define	RTOS_COMMON_PCI_IVSHMEM \
-	PCI_IVSHMEM_UNDEFINED(0, 0, 5, 1, 3)
+	PCI_IVSHMEM_UNDEFINED(0, 0, 0, 1, 3)
diff --git a/configs/arm64/imx8mp-rtos.h b/configs/arm64/imx8mp-rtos.h
index 4781dbf8..ed343c5a 100644
--- a/configs/arm64/imx8mp-rtos.h
+++ b/configs/arm64/imx8mp-rtos.h
@@ -5,6 +5,7 @@
  *
  * Authors:
  *  Stephane Viau <stephane.viau@nxp.com>
+ *  Fabrice Goucem <fabrice.goucem@nxp.com>
  *
  * This work is licensed under the terms of the GNU GPL, version 2.  See
  * the COPYING file in the top-level directory.
@@ -22,16 +23,18 @@ typedef enum IRQn {
 } IRQn_Type;
 
 #define RTOS_COMMON_MEMORY_REGIONS \
-	MMIO_REGION_RW( 0x302d0000, 0x302d0000, KB(64)), /* GPT1 */                 \
-	MMIO_REGION_RW( 0x302e0000, 0x302e0000, KB(64)), /* GPT2 */                 \
-	MMIO_REGION_ROS(0x30360000, 0x30360000, KB(64)), /* ANA_PLL */              \
-	MMIO_REGION_ROS(0x30380000, 0x30380000, KB(64)), /* CCM */                  \
-	MMIO_REGION_RW( 0x30a60000, 0x30a60000, KB(64)), /* UART4 */                \
 	MEM_REGION_ROS( 0xfd9f0000, 0xfd9f0000, KB(4)),  /* IVSHMEM */              \
 	MEM_REGION_RWS( 0xfd9f1000, 0xfd9f1000, KB(36)), /* IVSHMEM */              \
 	MEM_REGION_ROS( 0xfd9fa000, 0xfd9fa000, KB(8)),  /* IVSHMEM */              \
 	MEM_REGION_RWS( 0xfd9fc000, 0xfd9fc000, KB(8)),  /* IVSHMEM */              \
-	MEM_REGION_ROS( 0xfd9fe000, 0xfd9fe000, KB(8))   /* IVSHMEM */
+	MEM_REGION_ROS( 0xfd9fe000, 0xfd9fe000, KB(8)),  /* IVSHMEM */              \
+	/* IVSHMEM regions should always be kept on top so PCI_IVS doesn't change */\
+	MMIO_REGION_RW( 0x302d0000, 0x302d0000, KB(64)), /* GPT1 */                 \
+	MMIO_REGION_RW( 0x302e0000, 0x302e0000, KB(64)), /* GPT2 */                 \
+	MMIO_REGION_RWS(0x30330000, 0x30330000, KB(64)), /* IOMUXC */               \
+	MMIO_REGION_ROS(0x30360000, 0x30360000, KB(64)), /* ANA_PLL */              \
+	MMIO_REGION_ROS(0x30380000, 0x30380000, KB(64)), /* CCM */                  \
+	MMIO_REGION_RW( 0x30a60000, 0x30a60000, KB(64))  /* UART4 */                \
 
 /* interrupts 32..63 */
 #define RTOS_COMMON_IRQCHIP0_BITMAP1 \
@@ -51,4 +54,4 @@ typedef enum IRQn {
 	0
 
 #define	RTOS_COMMON_PCI_IVSHMEM \
-	PCI_IVSHMEM_UNDEFINED(2, 0, 5, 1, 3)
+	PCI_IVSHMEM_UNDEFINED(2, 0, 0, 1, 3)
-- 
2.34.1

