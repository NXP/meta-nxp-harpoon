From e44d1d7fe449f91492c9c0fa0bca53c040e2a02c Mon Sep 17 00:00:00 2001
From: Stephane Viau <stephane.viau@nxp.com>
Date: Wed, 26 Jan 2022 16:31:27 +0000
Subject: [PATCH 25/54] imx8m{m,n,p}: freertos: add new cell for industrial use
 case

Signed-off-by: Stephane Viau <stephane.viau@nxp.com>
(rename configs: add harpoon prefix)
Signed-off-by: Marouen Ghodhbane <marouen.ghodhbane@nxp.com>
---
 configs/arm64/imx8mm-harpoon-freertos-audio.c |  2 +-
 .../imx8mm-harpoon-freertos-industrial.c      | 56 ++++++++++++++++++
 configs/arm64/imx8mn-harpoon-freertos-audio.c |  2 +-
 .../imx8mn-harpoon-freertos-industrial.c      | 56 ++++++++++++++++++
 configs/arm64/imx8mp-harpoon-freertos-audio.c |  2 +-
 .../imx8mp-harpoon-freertos-industrial.c      | 57 +++++++++++++++++++
 6 files changed, 172 insertions(+), 3 deletions(-)
 create mode 100644 configs/arm64/imx8mm-harpoon-freertos-industrial.c
 create mode 100644 configs/arm64/imx8mn-harpoon-freertos-industrial.c
 create mode 100644 configs/arm64/imx8mp-harpoon-freertos-industrial.c

diff --git a/configs/arm64/imx8mm-harpoon-freertos-audio.c b/configs/arm64/imx8mm-harpoon-freertos-audio.c
index 47db6581..dff87033 100644
--- a/configs/arm64/imx8mm-harpoon-freertos-audio.c
+++ b/configs/arm64/imx8mm-harpoon-freertos-audio.c
@@ -1,5 +1,5 @@
 /*
- * i.MX8MM target - FreeRTOS
+ * i.MX8MM target - FreeRTOS audio config
  *
  * Copyright 2021-2022 NXP
  *
diff --git a/configs/arm64/imx8mm-harpoon-freertos-industrial.c b/configs/arm64/imx8mm-harpoon-freertos-industrial.c
new file mode 100644
index 00000000..4efb70fb
--- /dev/null
+++ b/configs/arm64/imx8mm-harpoon-freertos-industrial.c
@@ -0,0 +1,56 @@
+/*
+ * i.MX8MM target - FreeRTOS industrial config
+ *
+ * Copyright 2022 NXP
+ *
+ * Authors:
+ *  Stephane Viau <stephane.viau@nxp.com>
+ *
+ * This work is licensed under the terms of the GNU GPL, version 2.  See
+ * the COPYING file in the top-level directory.
+ */
+
+#include "cell-helper.h"
+#include "imx8mm-harpoon-rtos.h"
+
+/* Name, cores, entry point */
+#define CONFIG_INMATE_NAME		"freertos"
+#define CONFIG_INMATE_CORE_BITMAP	(0b1000)
+#define CONFIG_INMATE_BASE		(0xc0000000)
+
+/* Memory & peripherals */
+#define CONFIG_INMATE_REGIONS		\
+	RTOS_COMMON_MEMORY_REGIONS,                                     \
+	MEM_REGION_RWXL(0x93c00000, 0xc0000000, MB(16)),   /* RAM */    \
+	MEM_REGION_RWX( 0x00900000, 0x00900000, KB(384)),  /* OCRAM */  \
+	MEM_REGION_RW(  0x00800000, 0x00800000, KB(128)),  /* DTCM */   \
+	MEM_REGION_RWX( 0x007e0000, 0x007e0000, KB(128)),  /* ITCM */   \
+	MMIO_REGION_RWS(0x30360000, 0x30360000, KB(64))    /* ANA_PLL */
+
+/* GIC */
+#define CONFIG_INMATE_IRQCHIPS_ADDR	(0x38800000)
+#define CONFIG_INMATE_IRQCHIPS \
+	IRQCHIP0(CONFIG_INMATE_IRQCHIPS_ADDR,              \
+		/* interrupts 32..63 */                    \
+		RTOS_COMMON_IRQCHIP0_BITMAP1,              \
+		/* interrupts 64..95 */                    \
+		RTOS_COMMON_IRQCHIPS_BITMAP2,              \
+		/* interrupts 96..127 */                   \
+		RTOS_COMMON_IRQCHIPS_BITMAP3,              \
+		/* interrupts 128..159 */                  \
+		RTOS_COMMON_IRQCHIPS_BITMAP4),             \
+	IRQCHIP1(CONFIG_INMATE_IRQCHIPS_ADDR,              \
+		/* interrupts 160..191 */                  \
+		0,                                         \
+		/* interrupts 192..223 */                  \
+		0,                                         \
+		/* interrupts 224..255 */                  \
+		0,                                         \
+		/* interrupts 256..287 */                  \
+		0)
+
+/* IVSHMEM PCI */
+#define CONFIG_INMATE_PCI_DEVICES \
+	RTOS_COMMON_PCI_IVSHMEM
+
+#include "cell-create.h"
diff --git a/configs/arm64/imx8mn-harpoon-freertos-audio.c b/configs/arm64/imx8mn-harpoon-freertos-audio.c
index ccd4c376..d553d201 100644
--- a/configs/arm64/imx8mn-harpoon-freertos-audio.c
+++ b/configs/arm64/imx8mn-harpoon-freertos-audio.c
@@ -1,5 +1,5 @@
 /*
- * i.MX8MN target - FreeRTOS
+ * i.MX8MN target - FreeRTOS audio config
  *
  * Copyright 2021-2022 NXP
  *
diff --git a/configs/arm64/imx8mn-harpoon-freertos-industrial.c b/configs/arm64/imx8mn-harpoon-freertos-industrial.c
new file mode 100644
index 00000000..7b179cb9
--- /dev/null
+++ b/configs/arm64/imx8mn-harpoon-freertos-industrial.c
@@ -0,0 +1,56 @@
+/*
+ * i.MX8MN target - FreeRTOS industrial config
+ *
+ * Copyright 2022 NXP
+ *
+ * Authors:
+ *  Stephane Viau <stephane.viau@nxp.com>
+ *
+ * This work is licensed under the terms of the GNU GPL, version 2.  See
+ * the COPYING file in the top-level directory.
+ */
+
+#include "cell-helper.h"
+#include "imx8mn-harpoon-rtos.h"
+
+/* Name, cores, entry point */
+#define CONFIG_INMATE_NAME		"freertos"
+#define CONFIG_INMATE_CORE_BITMAP	(0b1000)
+#define CONFIG_INMATE_BASE		(0xc0000000)
+
+/* Memory & peripherals */
+#define CONFIG_INMATE_REGIONS		\
+	RTOS_COMMON_MEMORY_REGIONS,                                     \
+	MEM_REGION_RWXL(0x93c00000, 0xc0000000, MB(16)),   /* RAM */    \
+	MEM_REGION_RWX( 0x00900000, 0x00900000, KB(384)),  /* OCRAM */  \
+	MEM_REGION_RW(  0x00800000, 0x00800000, KB(128)),  /* DTCM */   \
+	MEM_REGION_RWX( 0x007e0000, 0x007e0000, KB(128)),  /* ITCM */   \
+	MMIO_REGION_RWS(0x30360000, 0x30360000, KB(64))    /* ANA_PLL */
+
+/* GIC */
+#define CONFIG_INMATE_IRQCHIPS_ADDR	(0x38800000)
+#define CONFIG_INMATE_IRQCHIPS \
+	IRQCHIP0(CONFIG_INMATE_IRQCHIPS_ADDR,              \
+		/* interrupts 32..63 */                    \
+		RTOS_COMMON_IRQCHIP0_BITMAP1,              \
+		/* interrupts 64..95 */                    \
+		RTOS_COMMON_IRQCHIPS_BITMAP2,              \
+		/* interrupts 96..127 */                   \
+		RTOS_COMMON_IRQCHIPS_BITMAP3,              \
+		/* interrupts 128..159 */                  \
+		RTOS_COMMON_IRQCHIPS_BITMAP4),             \
+	IRQCHIP1(CONFIG_INMATE_IRQCHIPS_ADDR,              \
+		/* interrupts 160..191 */                  \
+		0,                                         \
+		/* interrupts 192..223 */                  \
+		0,                                         \
+		/* interrupts 224..255 */                  \
+		0,                                         \
+		/* interrupts 256..287 */                  \
+		0)
+
+/* IVSHMEM PCI */
+#define CONFIG_INMATE_PCI_DEVICES \
+	RTOS_COMMON_PCI_IVSHMEM
+
+#include "cell-create.h"
diff --git a/configs/arm64/imx8mp-harpoon-freertos-audio.c b/configs/arm64/imx8mp-harpoon-freertos-audio.c
index bcbea918..9d060d45 100644
--- a/configs/arm64/imx8mp-harpoon-freertos-audio.c
+++ b/configs/arm64/imx8mp-harpoon-freertos-audio.c
@@ -1,5 +1,5 @@
 /*
- * i.MX8MP target - FreeRTOS
+ * i.MX8MP target - FreeRTOS audio config
  *
  * Copyright 2021-2022 NXP
  *
diff --git a/configs/arm64/imx8mp-harpoon-freertos-industrial.c b/configs/arm64/imx8mp-harpoon-freertos-industrial.c
new file mode 100644
index 00000000..c5c55969
--- /dev/null
+++ b/configs/arm64/imx8mp-harpoon-freertos-industrial.c
@@ -0,0 +1,57 @@
+/*
+ * i.MX8MP target - FreeRTOS industrial config
+ *
+ * Copyright 2022 NXP
+ *
+ * Authors:
+ *  Stephane Viau <stephane.viau@nxp.com>
+ *
+ * This work is licensed under the terms of the GNU GPL, version 2.  See
+ * the COPYING file in the top-level directory.
+ */
+
+#include "cell-helper.h"
+#include "imx8mp-harpoon-rtos.h"
+
+/* Name, cores, entry point */
+#define CONFIG_INMATE_NAME		"freertos"
+#define CONFIG_INMATE_CORE_BITMAP	(0b1000)
+#define CONFIG_INMATE_BASE		(0xc0000000)
+
+/* Memory & peripherals */
+#define CONFIG_INMATE_REGIONS		\
+	RTOS_COMMON_MEMORY_REGIONS,                                     \
+	MEM_REGION_RWXL(0xc0000000, 0xc0000000, MB(16)),   /* RAM */    \
+	MEM_REGION_RWX( 0x00900000, 0x00900000, KB(384)),  /* OCRAM */  \
+	MEM_REGION_RW(  0x00800000, 0x00800000, KB(128)),  /* DTCM */   \
+	MEM_REGION_RWX( 0x007e0000, 0x007e0000, KB(128)),  /* ITCM */   \
+	MMIO_REGION_RWS(0x30360000, 0x30360000, KB(4))     /* ANA_PLL */\
+
+
+/* GIC */
+#define CONFIG_INMATE_IRQCHIPS_ADDR	(0x38800000)
+#define CONFIG_INMATE_IRQCHIPS \
+	IRQCHIP0(CONFIG_INMATE_IRQCHIPS_ADDR,              \
+		/* interrupts 32..63 */                    \
+		RTOS_COMMON_IRQCHIP0_BITMAP1,              \
+		/* interrupts 64..95 */                    \
+		RTOS_COMMON_IRQCHIPS_BITMAP2,              \
+		/* interrupts 96..127 */                   \
+		RTOS_COMMON_IRQCHIPS_BITMAP3,              \
+		/* interrupts 128..159 */                  \
+		RTOS_COMMON_IRQCHIPS_BITMAP4),             \
+	IRQCHIP1(CONFIG_INMATE_IRQCHIPS_ADDR,              \
+		/* interrupts 160..191 */                  \
+		0,                                         \
+		/* interrupts 192..223 */                  \
+		0,                                         \
+		/* interrupts 224..255 */                  \
+		0,                                         \
+		/* interrupts 256..287 */                  \
+		0)
+
+/* IVSHMEM PCI */
+#define CONFIG_INMATE_PCI_DEVICES \
+	RTOS_COMMON_PCI_IVSHMEM
+
+#include "cell-create.h"
-- 
2.34.1

