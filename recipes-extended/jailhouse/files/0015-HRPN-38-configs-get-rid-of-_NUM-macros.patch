From 85edde0869ea518df26a94bce2255fead965dbe1 Mon Sep 17 00:00:00 2001
From: Stephane Viau <stephane.viau@oss.nxp.com>
Date: Mon, 6 Dec 2021 15:39:12 +0100
Subject: [PATCH 15/43] HRPN-38 configs: get rid of *_NUM macros

Signed-off-by: Stephane Viau <stephane.viau@oss.nxp.com>
---
 configs/arm64/cell-create.h   | 14 +++++++++++---
 configs/arm64/cell-template.c |  2 --
 2 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/configs/arm64/cell-create.h b/configs/arm64/cell-create.h
index e3755d2b..066f9407 100644
--- a/configs/arm64/cell-create.h
+++ b/configs/arm64/cell-create.h
@@ -13,15 +13,23 @@
 #include <jailhouse/types.h>
 #include <jailhouse/cell-config.h>
 
-#if !defined(CONFIG_INMATE_PCI_NUM)
+#define CONFIG_INMATE_REGIONS_NUM \
+	(sizeof((struct jailhouse_memory[]){CONFIG_INMATE_REGIONS}) \
+	/ sizeof(struct jailhouse_memory))
+
+#if !defined(CONFIG_INMATE_PCI_DEVICES)
 #define CONFIG_INMATE_PCI_NUM 0
+#else
+#define CONFIG_INMATE_PCI_NUM \
+	(sizeof((struct jailhouse_pci_device[]){CONFIG_INMATE_PCI_DEVICES}) \
+	/ sizeof(struct jailhouse_pci_device))
 #endif
 
 struct {
 	struct jailhouse_cell_desc cell;
 	__u64 cpus[1];
 	struct jailhouse_memory mem_regions[CONFIG_INMATE_REGIONS_NUM + 1];
-	struct jailhouse_irqchip irqchips[CONFIG_INMATE_IRQCHIPS_NUM];
+	struct jailhouse_irqchip irqchips[1];
 	struct jailhouse_pci_device pci_devices[CONFIG_INMATE_PCI_NUM];
 } __attribute__((packed)) config = {
 	.cell = {
@@ -59,7 +67,7 @@ struct {
 		}
 	},
 
-#if defined(CONFIG_INMATE_PCI_NUM) && (CONFIG_INMATE_PCI_NUM > 0)
+#if defined(CONFIG_INMATE_PCI_DEVICES)
 	.pci_devices = {
 		CONFIG_INMATE_PCI_DEVICES
 	},
diff --git a/configs/arm64/cell-template.c b/configs/arm64/cell-template.c
index df0894fb..03e6de90 100644
--- a/configs/arm64/cell-template.c
+++ b/configs/arm64/cell-template.c
@@ -18,12 +18,10 @@
 #define CONFIG_INMATE_BASE		(0xc0000000) /* entry point in DDR */
 
 /* Memory & peripherals */
-#define CONFIG_INMATE_REGIONS_NUM	(1)
 #define CONFIG_INMATE_REGIONS		\
 	MEM_REGION_RWXL(0xc0000000, 0xc0000000, MB(16))   /* RAM */
 
 /* GIC */
-#define CONFIG_INMATE_IRQCHIPS_NUM	(1)
 #define CONFIG_INMATE_IRQCHIPS_ADDR	(0x38800000) /* GIC DISTRIBUTOR BASE ADDR */
 #define CONFIG_INMATE_IRQCHIPS_BASE	(32)
 #define CONFIG_INMATE_IRQCHIPS_BITMAP	\
-- 
2.25.1

