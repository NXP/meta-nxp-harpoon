From 436db0e3a990deaa6d65fcbe4e578f62c255027e Mon Sep 17 00:00:00 2001
From: Hou Zhiqiang <Zhiqiang.Hou@nxp.com>
Date: Mon, 9 Jan 2023 15:43:25 +0800
Subject: [PATCH 19/28] configs: arm64: imx93: add freertos and zephyr basic
 configs

Signed-off-by: Hou Zhiqiang <Zhiqiang.Hou@nxp.com>
(add tpm timer devices and rpmsg support)
Signed-off-by: Marouen Ghodhbane <marouen.ghodhbane@nxp.com>
---
 configs/arm64/imx93-harpoon-freertos.c |  47 ++++++++++
 configs/arm64/imx93-harpoon-rtos.h     | 118 +++++++++++++++++++++++++
 configs/arm64/imx93-harpoon-zephyr.c   |  47 ++++++++++
 3 files changed, 212 insertions(+)
 create mode 100644 configs/arm64/imx93-harpoon-freertos.c
 create mode 100644 configs/arm64/imx93-harpoon-rtos.h
 create mode 100644 configs/arm64/imx93-harpoon-zephyr.c

diff --git a/configs/arm64/imx93-harpoon-freertos.c b/configs/arm64/imx93-harpoon-freertos.c
new file mode 100644
index 00000000..336ead5b
--- /dev/null
+++ b/configs/arm64/imx93-harpoon-freertos.c
@@ -0,0 +1,47 @@
+/*
+ * i.MX93 target - FreeRTOS config
+ *
+ * Copyright 2023 NXP
+ *
+ * This work is licensed under the terms of the GNU GPL, version 2.  See
+ * the COPYING file in the top-level directory.
+ */
+
+#include "cell-helper.h"
+#include "imx93-harpoon-rtos.h"
+
+#define CONFIG_INMATE_NAME		"freertos"
+#define CONFIG_INMATE_CORE_BITMAP	(0b10)
+#define CONFIG_INMATE_BASE		RTOS_INMATE_BASE
+
+/* Memory & peripherals */
+#define CONFIG_INMATE_REGIONS                   \
+	RTOS_COMMON_MEMORY_REGIONS,             \
+	RTOS_MEMRAM_MEMORY_REGIONS
+
+#define CONFIG_INMATE_IRQCHIPS_ADDR	CONFIG_RTOS_IRQCHIPS_ADDR
+#define CONFIG_INMATE_IRQCHIPS 	                \
+	IRQCHIP0(CONFIG_INMATE_IRQCHIPS_ADDR,   \
+		/* interrupts 32..63 */         \
+		RTOS_COMMON_IRQCHIP0_BITMAP1,   \
+		/* interrupts 64..95 */         \
+		RTOS_COMMON_IRQCHIP0_BITMAP2,   \
+		/* interrupts 96..127 */        \
+		RTOS_COMMON_IRQCHIP0_BITMAP3,   \
+		/* interrupts 128..159 */       \
+		RTOS_COMMON_IRQCHIP0_BITMAP4),  \
+	IRQCHIP1(CONFIG_INMATE_IRQCHIPS_ADDR,   \
+		/* interrupts 160..191 */       \
+		RTOS_COMMON_IRQCHIP1_BITMAP1,   \
+		/* interrupts 192..223 */       \
+		RTOS_COMMON_IRQCHIP1_BITMAP2,   \
+		/* interrupts 224..255 */       \
+		RTOS_COMMON_IRQCHIP1_BITMAP3,   \
+		/* interrupts 256..287 */       \
+		RTOS_COMMON_IRQCHIP1_BITMAP4)
+
+/* IVSHMEM PCI */
+#define CONFIG_INMATE_PCI_DEVICES \
+	RTOS_COMMON_PCI_IVSHMEM
+
+#include "cell-create.h"
diff --git a/configs/arm64/imx93-harpoon-rtos.h b/configs/arm64/imx93-harpoon-rtos.h
new file mode 100644
index 00000000..c7150dd4
--- /dev/null
+++ b/configs/arm64/imx93-harpoon-rtos.h
@@ -0,0 +1,118 @@
+/*
+ * i.MX93 target - common RTOS config
+ *
+ * Copyright 2023 NXP
+ *
+ * This work is licensed under the terms of the GNU GPL, version 2.  See
+ * the COPYING file in the top-level directory.
+ *
+ */
+
+#define RTOS_INMATE_BASE		(0xd0000000)
+
+typedef enum IRQn {
+  /* Device specific interrupts */
+  LPUART2_IRQn                 = 52,               /**< Low Power UART 2 */
+  TPM2_IRQn                    = 69,               /**< Timer PWM Module (TPM) 2 */
+  TPM4_IRQn                    = 108,              /**< Timer PWM Module (TPM) 4 */
+  SW_MB_L_IRQn                 = 200,              /**< Unused SPI 168, to be used by generic software mailbox in Linux */
+  SW_MB_R_IRQn                 = 201,              /**< Unused SPI 169, to be used by generic software mailbox in RTOS */
+} IRQn_Type;
+
+#define RTOS_COMMON_MEMORY_REGIONS \
+	MEM_REGION_ROS( 0xfd9f0000, 0xfd9f0000, KB(4)),  /* IVSHMEM */              \
+	MEM_REGION_RWS( 0xfd9f1000, 0xfd9f1000, KB(36)), /* IVSHMEM */              \
+	MEM_REGION_ROS( 0xfd9fa000, 0xfd9fa000, KB(8)),  /* IVSHMEM */              \
+	MEM_REGION_RWS( 0xfd9fc000, 0xfd9fc000, KB(8)),  /* IVSHMEM */              \
+	MEM_REGION_ROS( 0xfd9fe000, 0xfd9fe000, KB(8)),  /* IVSHMEM */              \
+	/* IVSHMEM regions should always be kept on top so PCI_IVS doesn't change */\
+	MMIO_REGION_RWS(0xfe000000, 0xfe000000, KB(4)),  /* SW MBOX */              \
+	MMIO_REGION_RWS(0xfe100000, 0xfe100000, KB(64)), /* RPMSG */                \
+	MEM_REGION_RWS( 0xfe200000, 0xfe200000, MB(1)),  /* RPMSG BUF */            \
+	MMIO_REGION_RWS(0x443c0000, 0x443c0000, KB(64)), /* IOMUXC */               \
+	MMIO_REGION_RWS(0x44450000, 0x44450000, KB(64)), /* CCM */                  \
+	MMIO_REGION_ROS(0x44480000, 0x44480000, KB(64)), /* ANA_PLL */              \
+	MMIO_REGION_RW( 0x44390000, 0x44390000, KB(64)),  /* LPUART2 */             \
+	MMIO_REGION_RW( 0x44320000, 0x44320000, KB(64)),  /* TPM2 */                \
+	MMIO_REGION_RW( 0x424f0000, 0x424f0000, KB(64))   /* TPM4 */
+
+#define RTOS_MEMRAM_MEMORY_REGIONS \
+	MEM_REGION_RWXL(0xd0000000, 0xd0000000, MB(16)), /* RAM */    \
+	MEM_REGION_RWX( 0x20480000, 0x20480000, KB(640)) /* OCRAM */
+
+/* GIC */
+#define CONFIG_RTOS_IRQCHIPS_ADDR	(0x48000000)
+
+/* interrupts 32..63 */
+#define RTOS_COMMON_IRQCHIP0_BITMAP1 \
+	IRQnMAP(LPUART2_IRQn)
+#define RTOS_AUDIO_IRQCHIP0_BITMAP1 \
+	0
+#define RTOS_AVB_IRQCHIP0_BITMAP1 \
+	RTOS_AUDIO_IRQCHIP0_BITMAP1
+#define RTOS_INDUS_IRQCHIP0_BITMAP1 \
+	0
+
+/* interrupts 64..95 */
+#define RTOS_COMMON_IRQCHIP0_BITMAP2 \
+	IRQnMAP(TPM2_IRQn)
+#define RTOS_AUDIO_IRQCHIP0_BITMAP2 \
+	0
+#define RTOS_AVB_IRQCHIP0_BITMAP2 \
+	RTOS_AUDIO_IRQCHIP0_BITMAP2
+#define RTOS_INDUS_IRQCHIP0_BITMAP2 \
+	0
+
+/* interrupts 96..127 */
+#define RTOS_COMMON_IRQCHIP0_BITMAP3 \
+	IRQnMAP(TPM4_IRQn)
+#define RTOS_AUDIO_IRQCHIP0_BITMAP3 \
+	0
+#define RTOS_AVB_IRQCHIP0_BITMAP3 \
+	RTOS_AUDIO_IRQCHIP0_BITMAP3
+#define RTOS_INDUS_IRQCHIP0_BITMAP3 \
+	0
+
+/* interrupts 128..159 */
+#define RTOS_COMMON_IRQCHIP0_BITMAP4 \
+	0
+#define RTOS_AUDIO_IRQCHIP0_BITMAP4 \
+	0
+#define RTOS_AVB_IRQCHIP0_BITMAP4 \
+		RTOS_AUDIO_IRQCHIP0_BITMAP4
+#define RTOS_INDUS_IRQCHIP0_BITMAP4 \
+	0
+
+/* interrupts 160..191 */
+#define RTOS_COMMON_IRQCHIP1_BITMAP1 \
+	0
+#define RTOS_AUDIO_IRQCHIP1_BITMAP1 \
+	0
+#define RTOS_AVB_IRQCHIP1_BITMAP1 \
+	RTOS_AUDIO_IRQCHIP1_BITMAP1 | \
+	0
+#define RTOS_INDUS_IRQCHIP1_BITMAP1 \
+	0
+
+/* interrupts 192..223 */
+#define RTOS_COMMON_IRQCHIP1_BITMAP2 \
+	IRQnMAP(SW_MB_R_IRQn)
+#define RTOS_AUDIO_IRQCHIP1_BITMAP2 \
+	0
+#define RTOS_AVB_IRQCHIP1_BITMAP2 \
+	RTOS_AUDIO_IRQCHIP1_BITMAP2 | \
+	0
+#define RTOS_INDUS_IRQCHIP1_BITMAP2 \
+	0
+
+/* interrupts 224..255 */
+#define RTOS_COMMON_IRQCHIP1_BITMAP3 \
+	0
+
+/* interrupts 256..287 */
+#define RTOS_COMMON_IRQCHIP1_BITMAP4 \
+	0
+
+/* IVSHMEM PCI */
+#define	RTOS_COMMON_PCI_IVSHMEM \
+	PCI_IVSHMEM_UNDEFINED(0, 0, 0, 1, 3)
diff --git a/configs/arm64/imx93-harpoon-zephyr.c b/configs/arm64/imx93-harpoon-zephyr.c
new file mode 100644
index 00000000..13007be2
--- /dev/null
+++ b/configs/arm64/imx93-harpoon-zephyr.c
@@ -0,0 +1,47 @@
+/*
+ * i.MX93 target - Zephyr config
+ *
+ * Copyright 2023 NXP
+ *
+ * This work is licensed under the terms of the GNU GPL, version 2.  See
+ * the COPYING file in the top-level directory.
+ */
+
+#include "cell-helper.h"
+#include "imx93-harpoon-rtos.h"
+
+#define CONFIG_INMATE_NAME		"zephyr"
+#define CONFIG_INMATE_CORE_BITMAP	(0b10)
+#define CONFIG_INMATE_BASE		RTOS_INMATE_BASE
+
+/* Memory & peripherals */
+#define CONFIG_INMATE_REGIONS                   \
+	RTOS_COMMON_MEMORY_REGIONS,             \
+	RTOS_MEMRAM_MEMORY_REGIONS
+
+#define CONFIG_INMATE_IRQCHIPS_ADDR	CONFIG_RTOS_IRQCHIPS_ADDR
+#define CONFIG_INMATE_IRQCHIPS 	                \
+	IRQCHIP0(CONFIG_INMATE_IRQCHIPS_ADDR,   \
+		/* interrupts 32..63 */         \
+		RTOS_COMMON_IRQCHIP0_BITMAP1,   \
+		/* interrupts 64..95 */         \
+		RTOS_COMMON_IRQCHIP0_BITMAP2,   \
+		/* interrupts 96..127 */        \
+		RTOS_COMMON_IRQCHIP0_BITMAP3,   \
+		/* interrupts 128..159 */       \
+		RTOS_COMMON_IRQCHIP0_BITMAP4),  \
+	IRQCHIP1(CONFIG_INMATE_IRQCHIPS_ADDR,   \
+		/* interrupts 160..191 */       \
+		RTOS_COMMON_IRQCHIP1_BITMAP1,   \
+		/* interrupts 192..223 */       \
+		RTOS_COMMON_IRQCHIP1_BITMAP2,   \
+		/* interrupts 224..255 */       \
+		RTOS_COMMON_IRQCHIP1_BITMAP3,   \
+		/* interrupts 256..287 */       \
+		RTOS_COMMON_IRQCHIP1_BITMAP4)
+
+/* IVSHMEM PCI */
+#define CONFIG_INMATE_PCI_DEVICES \
+	RTOS_COMMON_PCI_IVSHMEM
+
+#include "cell-create.h"
-- 
2.34.1

